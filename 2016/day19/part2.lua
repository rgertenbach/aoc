-- sloooooow
package.path = "../../../llib/lua/?.lua;" .. package.path


local dll = require("dlist")

local input = 3018458

---@param elves integer
---@return integer elf
local function last_elf(elves)
  local current = dll.node(1)
  local first = current
  while current.val < elves do
    dll.insert_after(current, current.val + 1)
    current = current.next
  end
  current.next = first
  first.prev = current
  current = first
  while current.next ~= current do
    if elves == 1 then break end
    local stride = math.floor(elves / 2)
    local removeable = current
    while stride > 1 do
      removeable = removeable.next
      stride = stride - 1
    end
    dll.remove_next(removeable)
    elves = elves - 1
    current = current.next
  end
  return current.val
end

print(last_elf(1))
print(last_elf(2))
print(last_elf(3))
print(last_elf(4))
print(last_elf(5))
print(last_elf(6))
print(last_elf(7))
print(last_elf(8))
print(last_elf(9))
print(last_elf(10))
print(last_elf(11))
print(last_elf(12))
print(last_elf(13))
print(last_elf(14))
print(last_elf(15))
print(last_elf(16))
print(last_elf(17))
print(last_elf(18))
print(last_elf(19))
print(last_elf(20))
print(last_elf(21))
print(last_elf(22))
print(last_elf(23))
print(last_elf(24))
print(last_elf(25))
print(last_elf(26))
print(last_elf(27))
print(last_elf(28))
print(last_elf(29))
print(last_elf(30))
print(last_elf(31))
print(last_elf(32))
print(last_elf(33))
print(last_elf(34))
print(last_elf(35))
print(last_elf(36))
print(last_elf(37))
print(last_elf(38))
print(last_elf(39))
print(last_elf(40))
print(last_elf(41))
print(last_elf(42))
print(last_elf(43))
print(last_elf(44))
print(last_elf(45))
print(last_elf(46))
print(last_elf(47))
print(last_elf(48))
print(last_elf(49))
print(last_elf(50))
print(last_elf(51))
print(last_elf(52))
print(last_elf(53))
print(last_elf(54))
print(last_elf(55))
print(last_elf(56))
print(last_elf(57))
print(last_elf(58))
print(last_elf(59))
print(last_elf(60))
print(last_elf(61))
print(last_elf(62))
print(last_elf(63))
print(last_elf(64))
print(last_elf(65))
print(last_elf(66))
print(last_elf(67))
print(last_elf(68))
print(last_elf(69))
print(last_elf(70))
print(last_elf(71))
print(last_elf(72))
print(last_elf(73))
print(last_elf(74))
print(last_elf(75))
print(last_elf(76))
print(last_elf(77))
print(last_elf(78))
print(last_elf(79))
print(last_elf(80))
print(last_elf(81))
print(last_elf(82))
print(last_elf(83))
print(last_elf(84))
print(last_elf(85))
print(last_elf(86))
print(last_elf(87))
print(last_elf(88))
print(last_elf(89))
print(last_elf(90))
print(last_elf(91))
print(last_elf(92))
print(last_elf(93))
print(last_elf(94))
print(last_elf(95))
print(last_elf(96))
print(last_elf(97))
print(last_elf(98))
print(last_elf(99))
print(last_elf(100))
print(last_elf(101))
print(last_elf(102))
print(last_elf(103))
print(last_elf(104))
print(last_elf(105))
print(last_elf(106))
print(last_elf(107))
print(last_elf(108))
print(last_elf(109))
print(last_elf(110))
print(last_elf(111))
print(last_elf(112))
print(last_elf(113))
print(last_elf(114))
print(last_elf(115))
print(last_elf(116))
print(last_elf(117))
print(last_elf(118))
print(last_elf(119))
print(last_elf(120))
print(last_elf(121))
print(last_elf(122))
print(last_elf(123))
print(last_elf(124))
print(last_elf(125))
print(last_elf(126))
print(last_elf(127))
print(last_elf(128))
print(last_elf(129))
print(last_elf(130))
print(last_elf(131))
print(last_elf(132))
print(last_elf(133))
print(last_elf(134))
print(last_elf(135))
print(last_elf(136))
print(last_elf(137))
print(last_elf(138))
print(last_elf(139))
print(last_elf(140))
print(last_elf(141))
print(last_elf(142))
print(last_elf(143))
print(last_elf(144))
print(last_elf(145))
print(last_elf(146))
print(last_elf(147))
print(last_elf(148))
print(last_elf(149))
print(last_elf(150))
print(last_elf(151))
print(last_elf(152))
print(last_elf(153))
print(last_elf(154))
print(last_elf(155))
print(last_elf(156))
print(last_elf(157))
print(last_elf(158))
print(last_elf(159))
print(last_elf(160))
print(last_elf(161))
print(last_elf(162))
print(last_elf(163))
print(last_elf(164))
print(last_elf(165))
print(last_elf(166))
print(last_elf(167))
print(last_elf(168))
print(last_elf(169))
print(last_elf(170))
print(last_elf(171))
print(last_elf(172))
print(last_elf(173))
print(last_elf(174))
print(last_elf(175))
print(last_elf(176))
print(last_elf(177))
print(last_elf(178))
print(last_elf(179))
print(last_elf(180))
print(last_elf(181))
print(last_elf(182))
print(last_elf(183))
print(last_elf(184))
print(last_elf(185))
print(last_elf(186))
print(last_elf(187))
print(last_elf(188))
print(last_elf(189))
print(last_elf(190))
print(last_elf(191))
print(last_elf(192))
print(last_elf(193))
print(last_elf(194))
print(last_elf(195))
print(last_elf(196))
print(last_elf(197))
print(last_elf(198))
print(last_elf(199))
print(last_elf(200))
print(last_elf(201))


